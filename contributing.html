

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Contributing to ContactMechanics &mdash; ContactMechanics 1.0.0.dev64+g4a618ab documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="ContactMechanics package" href="source/ContactMechanics.html" />
    <link rel="prev" title="Testing" href="testing.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> ContactMechanics
          

          
          </a>

          
            
            
              <div class="version">
                1.0.0.dev64+g4a618ab
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Notes</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing.html#linter">Linter</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Contributing to ContactMechanics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#development">Development</a></li>
<li class="toctree-l2"><a class="reference internal" href="#code-style">Code style</a></li>
<li class="toctree-l2"><a class="reference internal" href="#development-branches">Development branches</a></li>
<li class="toctree-l2"><a class="reference internal" href="#commits">Commits</a></li>
<li class="toctree-l2"><a class="reference internal" href="#authors">Authors</a></li>
<li class="toctree-l2"><a class="reference internal" href="#writing-tests">Writing tests</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#mpi-tests">MPI Tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="#debug-plots-in-the-tests">Debug plots in the tests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#compiling-the-documentation">Compiling the documentation</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Package Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="source/ContactMechanics.html">ContactMechanics package</a></li>
<li class="toctree-l1"><a class="reference internal" href="source/ContactMechanics.GreensFunctions.html">ContactMechanics.GreensFunctions package</a></li>
<li class="toctree-l1"><a class="reference internal" href="source/ContactMechanics.IO.html">ContactMechanics.IO package</a></li>
<li class="toctree-l1"><a class="reference internal" href="source/ContactMechanics.Optimization.html">ContactMechanics.Optimization package</a></li>
<li class="toctree-l1"><a class="reference internal" href="source/ContactMechanics.ReferenceSolutions.html">ContactMechanics.ReferenceSolutions package</a></li>
<li class="toctree-l1"><a class="reference internal" href="source/ContactMechanics.Tools.html">ContactMechanics.Tools package</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">ContactMechanics</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Contributing to ContactMechanics</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/contributing.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="contributing-to-contactmechanics">
<span id="contributing"></span><h1>Contributing to ContactMechanics<a class="headerlink" href="#contributing-to-contactmechanics" title="Permalink to this heading">¶</a></h1>
<section id="development">
<h2>Development<a class="headerlink" href="#development" title="Permalink to this heading">¶</a></h2>
<p>To use the code without installing it, e.g. for development purposes, use the <cite>env.sh</cite> script to set the environment:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span> /path/to/PyCo/env.sh <span class="o">[</span>python3<span class="o">]</span>
</pre></div>
</div>
<p>Note that the parameter to <cite>env.sh</cite> specifies the Python interpreter for which the environment is set up. PyCo contains portions that need to be compiled, make sure to run</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python setup.py build
</pre></div>
</div>
<p>whenever any of the Cython (.pyx) sources are modified.</p>
</section>
<section id="code-style">
<h2>Code style<a class="headerlink" href="#code-style" title="Permalink to this heading">¶</a></h2>
<p>Always follow <a class="reference external" href="https://www.python.org/dev/peps/pep-0008/">PEP-8</a>.
Documentation strings must follow the
<a class="reference external" href="https://numpydoc.readthedocs.io/">numpydoc</a> standard.</p>
<p>All parameters (for functions or methods) should be descriptive. Do not name
a parameter after a symbol (e.g. <cite>lambda</cite>) but rather say that it is
(e.g. <cite>large_wavelength_cutoff</cite>).</p>
</section>
<section id="development-branches">
<h2>Development branches<a class="headerlink" href="#development-branches" title="Permalink to this heading">¶</a></h2>
<p>New features should be developed always in its own branch. When creating your own branch,
please suffix that branch by the year of creation on a description of what is contains.
For example, if you are working on an implementation for line scans and you started that
work in 2018, the branch could be called “18_line_scans”.</p>
</section>
<section id="commits">
<h2>Commits<a class="headerlink" href="#commits" title="Permalink to this heading">¶</a></h2>
<p>Prepend you commits with a shortcut indicating the type of changes they contain:</p>
<ul class="simple">
<li><p>ENH: Enhancement (e.g. a new feature)</p></li>
<li><p>MAINT: Maintenance (e.g. fixing a typo)</p></li>
<li><p>DOC: Changes to documentation strings</p></li>
<li><p>BUG: Bug fix</p></li>
<li><p>TST: Changes to the unit test environment</p></li>
<li><p>CI: Changes to the CI configuration</p></li>
</ul>
<p>The changelog will be based on the content of the commits with tag BUG, API and ENH.</p>
<p>Examples:</p>
<ul class="simple">
<li><p>If your are working on a new feature, use ENH on the commit making the feature ready. Before use the WIP tag.</p></li>
<li><p>use TST when your changes only deal with the testing environment. If you fix a bug and implement the test for it, use BUG.</p></li>
<li><p>minor changes that doesn’t change the codes behaviour (for example rewrite file in a cleaner or slightly efficienter way) belong to the tag MAINT</p></li>
<li><p>if you change documentation files without changing the code, use DOC; if you also change code in the same commit, use another shortcut</p></li>
</ul>
</section>
<section id="authors">
<h2>Authors<a class="headerlink" href="#authors" title="Permalink to this heading">¶</a></h2>
<p>Add yourself to the AUTHORS file using the email address that you are using for your
commits. We use this information to automatically generate copyright statements for
all files from the commit log.</p>
</section>
<section id="writing-tests">
<h2>Writing tests<a class="headerlink" href="#writing-tests" title="Permalink to this heading">¶</a></h2>
<p>Older tests are written using the <cite>unittest</cite> syntax. We now use <cite>pytest</cite> (that
understands almost all unittest syntaxes), because it is compatible with the
parallel test runner <a class="reference external" href="https://github.com/bccp/runtests">runtests</a>.</p>
<p>If a whole test file should only be run in serial
and/or is incompatible with <cite>runtests</cite> (<cite>unittest</cite>), include following line:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">NuMPI</span> <span class="kn">import</span> <span class="n">MPI</span>
<span class="kn">import</span> <span class="nn">pytest</span>

<span class="n">pytestmark</span> <span class="o">=</span> <span class="n">pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">skipif</span><span class="p">(</span><span class="n">MPI</span><span class="o">.</span><span class="n">COMM_WORLD</span><span class="o">.</span><span class="n">Get_size</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">,</span>
                                <span class="n">reason</span><span class="o">=</span><span class="s2">&quot;tests only serial funcionalities, &quot;</span>
                                       <span class="s2">&quot;please execute with pytest&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The file will executed in a run with <cite>pytest</cite> and not with a (parallel) run with
<cite>python3 run-tests.py</cite></p>
<section id="mpi-tests">
<h3>MPI Tests<a class="headerlink" href="#mpi-tests" title="Permalink to this heading">¶</a></h3>
<p>In order to vary the number of processors used in the tests, you should always
explictely use the communicator defined as fixture in <cite>test/conftest.py</cite> instead
of <cite>MPI.COMM_WORLD</cite>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_parallel</span><span class="p">(</span><span class="n">comm</span><span class="p">):</span>
    <span class="n">substrate</span> <span class="o">=</span> <span class="n">PeriodicFFTElasticHalfSpace</span><span class="p">(</span><span class="o">....</span><span class="p">,</span> <span class="n">commincator</span><span class="o">=</span><span class="n">comm</span><span class="p">)</span>
    <span class="c1"># Take care not to let your functions use their default value</span>
    <span class="c1"># for the communicator !</span>
</pre></div>
</div>
<p>Note: a single test function that should be run only with one processor:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_parallel</span><span class="p">(</span><span class="n">comm_serial</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">NuMPI</span> <span class="kn">import</span> <span class="n">MPI</span>
<span class="kn">import</span> <span class="nn">pytest</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">skipif</span><span class="p">(</span><span class="n">MPI</span><span class="o">.</span><span class="n">COMM_WORLD</span><span class="o">.</span><span class="n">Get_size</span><span class="p">()</span><span class="o">&gt;</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="n">reason</span><span class="o">=</span><span class="s2">&quot;tests only serial funcionalities, &quot;</span>
                           <span class="s2">&quot;please execute with pytest&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_parallel</span><span class="p">(</span><span class="n">comm_serial</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>How does <code class="code docutils literal notranslate"><span class="pre">runtests</span></code> behave when only one rank fails in the test ?</p>
<p>See <cite>test/_test_parallel_testing.py</cite>. Nothing is special is necarry
to do for the assertions. <code class="code docutils literal notranslate"><span class="pre">run-tests.py</span></code> will if only one rank fails in
one test.</p>
<p>However the errors may be cleaner if you parallelise the assertion.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pnp</span> <span class="o">=</span> <span class="n">Reduction</span><span class="p">(</span><span class="n">comm</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">pnp</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">is_ok_boolean</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="debug-plots-in-the-tests">
<h3>Debug plots in the tests<a class="headerlink" href="#debug-plots-in-the-tests" title="Permalink to this heading">¶</a></h3>
<p>Often when you develop your test you need to plot and print things to see what
happens. It is a good idea to let the plots ready for use:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="kc">False</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="o">-</span> <span class="n">system</span><span class="o">.</span><span class="n">substrate</span><span class="o">.</span><span class="n">force</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;pressure&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="compiling-the-documentation">
<h2>Compiling the documentation<a class="headerlink" href="#compiling-the-documentation" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p>After changes to the ContactMechanics source, you have to build again: <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">setup.py</span> <span class="pre">build</span></code></p></li>
<li><p>Navigate into the docs folder: <code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">docs/</span></code></p></li>
<li><p>Automatically generate reStructuredText files from the source: <code class="docutils literal notranslate"><span class="pre">sphinx-apidoc</span> <span class="pre">-o</span> <span class="pre">source/</span> <span class="pre">../ContactMechanics</span></code>. Do this just once, or if you have added/removed classes or methods. In case of the latter, be sure to remove the previous source before: <code class="docutils literal notranslate"><span class="pre">rm</span> <span class="pre">-rf</span> <span class="pre">source/</span></code></p></li>
<li><p>Build html files: <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">html</span></code></p></li>
<li><p>The resulting html files can be found in the <code class="docutils literal notranslate"><span class="pre">ContactMechanics/docs/_build/html/</span></code> folder. Root is <code class="docutils literal notranslate"><span class="pre">ContactMechanics/docs/_build/html/index.html</span></code>.</p></li>
</ul>
</section>
</section>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="source/ContactMechanics.html" class="btn btn-neutral float-right" title="ContactMechanics package" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="testing.html" class="btn btn-neutral float-left" title="Testing" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2015-2020 The Authors.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>